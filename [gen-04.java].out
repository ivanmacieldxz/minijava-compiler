.CODE
PUSH simple_heap_init
CALL
PUSH main@Init
CALL
HALT

simple_heap_init: RET 0
simple_malloc: LOADFP
LOADSP
STOREFP
LOADHL
DUP
PUSH 1
ADD
STORE 4
LOAD 3
ADD
STOREHL
STOREFP
RET 1


.DATA

vtObject: NOP

.CODE

constructor@Object: LOADFP
LOADSP
STOREFP
FMEM 0
STOREFP
RET 1

debugPrint@Object: LOADFP
LOADSP
STOREFP
LOAD 3
IPRINT
STOREFP
RET 1



.DATA

vtSystem: NOP

.CODE

constructor@System: LOADFP
LOADSP
STOREFP
FMEM 0
STOREFP
RET 1

read@System: LOADFP
LOADSP
STOREFP
READ
PUSH 48
SUB
STORE 3
STOREFP
RET 0

printB@System: LOADFP
LOADSP
STOREFP
LOAD 3
BPRINT
STOREFP
RET 1

printC@System: LOADFP
LOADSP
STOREFP
LOAD 3
CPRINT
STOREFP
RET 1

printI@System: LOADFP
LOADSP
STOREFP
LOAD 3
IPRINT
STOREFP
RET 1

printS@System: LOADFP
LOADSP
STOREFP
LOAD 3
SPRINT
STOREFP
RET 1

println@System: LOADFP
LOADSP
STOREFP
PRNLN
STOREFP
RET 0

printBln@System: LOADFP
LOADSP
STOREFP
LOAD 3
BPRINT
PRNLN
STOREFP
RET 1

printCln@System: LOADFP
LOADSP
STOREFP
LOAD 3
CPRINT
PRNLN
STOREFP
RET 1

printIln@System: LOADFP
LOADSP
STOREFP
LOAD 3
IPRINT
PRNLN
STOREFP
RET 1

printSln@System: LOADFP
LOADSP
STOREFP
LOAD 3
SPRINT
PRNLN
STOREFP
RET 1



.DATA

vtString: NOP

.CODE

constructor@String: LOADFP
LOADSP
STOREFP
FMEM 0
STOREFP
RET 1



.DATA

vtA: DW setall@A, m1@A

.CODE

constructor@A: LOADFP
LOADSP
STOREFP
FMEM 0
STOREFP
RET 1

setall@A: LOADFP
LOADSP
STOREFP
LOAD 4
LOAD 3
SWAP
STOREREF 1
LOAD 3
LOADREF 1 ; 
PUSH 2
MUL
LOAD 3
SWAP
STOREREF 2
.DATA
string0: DW  "hola", 0
.CODE
PUSH string0
LOAD 3
SWAP
STOREREF 3
FMEM 0
STOREFP
RET 2

m1@A: LOADFP
LOADSP
STOREFP
LOAD 3
LOADREF 1 ; 
PUSH debugPrint@Object
CALL
LOAD 3
LOADREF 2 ; 
PUSH debugPrint@Object
CALL
LOAD 3
LOADREF 3 ; 
PUSH printSln@System
CALL
FMEM 0
STOREFP
RET 1




.DATA

vtB: DW setall@A, m1@A, seta4@B, m2@B

.CODE

constructor@B: LOADFP
LOADSP
STOREFP
FMEM 0
STOREFP
RET 1

seta4@B: LOADFP
LOADSP
STOREFP
PUSH 4000
LOAD 3
SWAP
STOREREF 4
PUSH 55
LOAD 3
SWAP
STOREREF 5
FMEM 0
STOREFP
RET 1

m2@B: LOADFP
LOADSP
STOREFP
LOAD 3
LOADREF 4 ; 
PUSH debugPrint@Object
CALL
LOAD 3
LOADREF 5 ; 
PUSH debugPrint@Object
CALL
FMEM 0
STOREFP
RET 1






.DATA

vtInit: NOP

.CODE

constructor@Init: LOADFP
LOADSP
STOREFP
FMEM 0
STOREFP
RET 1

main@Init: LOADFP
LOADSP
STOREFP
RMEM 1
RMEM 1
PUSH 6
PUSH simple_malloc
CALL
DUP
PUSH vtB
STOREREF 0
DUP
PUSH constructor@B
CALL
STORE 0
LOAD 0
DUP
LOADREF 0 ; 
LOADREF 2 ; seta4
CALL
LOAD 0
PUSH 1234
SWAP
DUP
LOADREF 0 ; 
LOADREF 0 ; setall
CALL
LOAD 0
DUP
LOADREF 0 ; 
LOADREF 1 ; m1
CALL
LOAD 0
DUP
LOADREF 0 ; 
LOADREF 3 ; m2
CALL
FMEM 1
STOREFP
RET 0



